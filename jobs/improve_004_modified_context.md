---
context_files:
  - src/core/runner/mod.rs
  - src/models/job.rs
output_dir: src/core/
output_file: runner.rs
---

# Include Modified Files as Implicit Context

## Overview
Track which files were modified by previous jobs in a run and automatically include them as additional context for subsequent jobs. This helps the LLM understand the current state of code it may need to interact with.

## Problem
When running multiple jobs in sequence, later jobs may need to reference code that was generated by earlier jobs. Currently, the user must manually specify these as `context_files` in the job frontmatter, which is tedious and error-prone.

## Solution
Maintain a list of files modified during the current run session. For each subsequent job:
1. Check if any of the modified files would be useful context
2. Automatically add them as implicit context (in addition to explicitly specified files)
3. Respect the `max_context_files` limit
4. Prioritize explicit context over implicit context when limits apply

## Requirements

### 1. Add tracking in Runner
Add a field to track modified files during a run:
```rust
modified_files: Vec<PathBuf>,
```

After each successful job completion (code written to disk), add the output path to this list.

### 2. Update run_job to use modified files
When loading context files for a job:
1. Load the explicitly specified context files first
2. Check if any modified files from previous jobs in this run would be relevant
3. Add modified files as additional context if under the limit
4. Log which implicit context files were added

### 3. Relevance heuristic
A modified file is considered "relevant" if:
- It's in the same directory as the output file, OR
- It's explicitly referenced in the job instructions (simple substring match on filename), OR
- It has the same extension as the output file

### 4. Context limits
- `max_context_files` limit still applies to the total (explicit + implicit)
- Explicit context files take priority
- If at limit, skip implicit files with a debug log

### 5. Logging
- Info: "Added N implicit context files from previous jobs"
- Debug: List the specific files added

### 6. Update JobResult
Add a field to track implicit context used:
```rust
pub implicit_context_files: Vec<PathBuf>,
```

## Implementation Notes
- The modified_files list is cleared at the start of each `run_all()` call
- For `run_single()`, the list starts empty (no previous context)
- Only include modified files that still exist and are readable
- Don't include the job's own output file as context (that would be circular)

## Test Cases
- Test that modified files from job 1 are available as context to job 2
- Test that explicit context takes priority over implicit
- Test the relevance heuristic
- Test that limits are respected
